## ID: 200004

## HF

## Source: AD event logs

## Category: Malware

## Description: System Compromise via Kerberos Vulnerability

## Objective Statement:
This play is for a known vulnerability in the Kerberos Key software that allows an attacker to gain higher privileges than given.  The software is responsible for the privilege validation, a invalid check summary (checksum) of the keys allows a normal user to get administrator privileges on the domain. This gives an attack full Active Directory control, all accounts and services should be considered compromised if this attack was successfully carried out and detected.


## Result Analysis:
In the Active Directory Event Log a suspecious event will be generated. This exploits works becuase the Kerberos Key Distribution Center which is responsible for hanlding privilege validation. There is a problem in Windows Server 2012 Service Pack 1 where a valid Kerberos ticket with an invalid checksum can be created and used to obtain administrator privileges.


```
Suspicious Event ID 4769 with error code 0xf in Eventlog. 
This may have been an attempt to exploit MS14-068 REF:http://goo.gl/0RfON7 LOG: Security 
MESSAGE: A Kerberos service ticket was requested. Account Information: Account Name: malin4@DPI911.COM 
Account Domain: DPI911.COM Logon GUID: {4B14775A-0791-AA47-BC90-43C66F2662F2} 
Service Information: Service Name: MOOVEN-PC$ Service ID: S-1-5-22-1875060592-312617473-121947845-1137 
Network Information: Client Address: ::ffff:192.168.1.227 Client Port: 50979 Additional Information: Ticket Options: 0x40810000 
Ticket Encryption Type: 0x17 Failure Code: 0x0 Transited Services: -
```


## Mitigation
- A patch is availble from Microsoft to patch this vulnerability.
- The patch is the only and best way to secure a system against this
- If this exploit occured and was not stopped timely a complete rebuild of the domain will be required because if the attacker had administrative access and anything can be compromised
- All accounts and services should be considered compromised, deleted and created if this play was detected.
- https://blogs.technet.microsoft.com/srd/2014/11/18/additional-information-about-cve-2014-6324/


## Data Query Code
- Kerberos Key Distribution Center
- Authentication validation
- system compromised
- privilege escalation